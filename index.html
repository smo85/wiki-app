<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Wiki Information</title>

    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
  </head>

  <body>

      <header>

      </header>

      <section>

      </section>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <!-- <script type="text/javascript" src="js/script.js"></script> -->
    <script>
    var header = document.querySelector('header');
    var section = document.querySelector('section');

    var keyword = prompt("What would you like to search for?")
    //var keyword = 'cats'; //keyword that will be searched
    console.log("hello");

    function ajax (keyword) { //function to query wiki api with keyword
      $.ajax({
        url: "https://en.wikipedia.org/w/api.php?action=opensearch&search=" + keyword + "&limit=20&callback=?",

       dataType: "jsonp",
       success: function(response) {
           //console.log(response);
           if (response[1].length != 20) {
             showError(keyword);
           }
           else {
               populateHeader(response);
               showResults(response);
           }
      },
       error: function () {
        alert("Error retrieving search results, please refresh the page");
       }
     });
    }

    function getImage (keyword) { //function to query wiki api with keyword
      $.ajax({
        url: "https://en.wikipedia.org/w/api.php?action=query&format=json&prop=pageimages%7Cpageterms&generator=prefixsearch&redirects=1&formatversion=2&piprop=thumbnail&pithumbsize=250&pilimit=20&wbptterms=description&gpssearch=" + keyword + "&gpslimit=20",

       dataType: "jsonp",
       success: function(response) {
           //console.log(response.query.pages);
           if (response.query.pages.length != 20) {
             showError(keyword);
           }
           else {
               populateImages(response);
           }
      },
       error: function () {
        alert("Error retrieving search results, please refresh the page");
       }
     });
    }

    ajax(keyword);
    getImage(keyword);

    function populateHeader(response) {
      var myH1 = document.createElement('h1');
      myH1.textContent = keyword;
      header.appendChild(myH1);
      }

      function showResults(response) {
        var infoWiki = response;
        var infoWikiSize = response[1].length
        //console.log(infoWikiSize);
        var fragment = document.createDocumentFragment(); //this appends new h1 elements

        for (var i = 0; i < infoWikiSize; i++ ) {
          var myArticle = document.createElement('article');
          var myH2 = document.createElement('h2');
          var a = document.createElement('a');
          var myPara1 = document.createElement('p');
          //var myList = document.createElement('ul');

          // a.appendChild(myH2);
          a.href = infoWiki[3][i];
          a.innerText = infoWiki[1][i];
          myH2.append(a);
          //myH2.innerText = infoWiki[i].title;
          myPara1.innerHTML = infoWiki[2][i];
          //console.log(a);
          var headers = document.getElementsByTagName('h2');
          //console.log(headers[2]);
          fragment.appendChild(myH2);
          fragment.appendChild(myPara1);
      }
        myArticle.appendChild(fragment);
        section.appendChild(myArticle);
    }

    function populateImages(response) {
        console.log(response.query.pages[2].terms.description);
        var imgWiki = response.query.pages;
        console.log(response.query.pages.length);
        var fragment = document.createDocumentFragment();

        for (var j = 0; j < imgWiki.length; j++) {
          var myImg = document.createElement('img');
          if (imgWiki[j].hasOwnProperty("thumbnail") === true) {
          myImg.src = response.query.pages[j].thumbnail.source;
          //myImg.alt = response.query.pages[j].terms.description;
        } else {
          myImg.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Article_icon_cropped.svg/512px-Article_icon_cropped.svg.png";
          myImg.alt = "No picture";
        }
          fragment.appendChild(myImg);

        }
        myLI = document.createElement('li')
        myLI.appendChild(fragment);
        section.appendChild(myLI);
    }

    </script>
  </body>
</html>
